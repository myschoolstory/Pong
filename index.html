<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two-Player Pong</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: white;
        }
        
        .game-container {
            text-align: center;
        }
        
        canvas {
            border: 2px solid #fff;
            background: #000;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .player-controls {
            text-align: center;
        }
        
        .score {
            font-size: 48px;
            margin: 20px 0;
            letter-spacing: 10px;
        }
        
        .instructions {
            margin-top: 20px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .power-up-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #fff;
            padding: 30px;
            border-radius: 10px;
            z-index: 1000;
        }
        
        .power-up-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .power-up-option {
            border: 2px solid #fff;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }
        
        .power-up-option:hover {
            background: #333;
            transform: scale(1.05);
        }
        
        .power-up-option.selected {
            background: #ffff00;
            color: #000;
            border-color: #ffff00;
        }
        
        .power-up-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .power-up-description {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .menu-buttons {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .menu-button {
            padding: 10px 20px;
            border: 2px solid #fff;
            background: transparent;
            color: white;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .menu-button:hover {
            background: #fff;
            color: #000;
        }
        
        .menu-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="score">
            <span id="player1Score">0</span> - <span id="player2Score">0</span>
        </div>
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div class="controls">
            <div class="player-controls">
                <h3>Player 1</h3>
                <p>W - Up<br>S - Down</p>
            </div>
            <div class="player-controls">
                <h3>Player 2</h3>
                <p>‚Üë - Up<br>‚Üì - Down</p>
            </div>
        </div>
        <div class="instructions">
            First to 10 points wins! Press any key to start.<br>
            <small>Losing players get to choose power-ups that last until opponent scores!</small>
        </div>
    </div>

    <!-- Power-up Selection Menu -->
    <div id="powerUpMenu" class="power-up-menu hidden">
        <h2 id="menuTitle">Choose Your Power-up!</h2>
        <div class="power-up-options">
            <div class="power-up-option" data-power="glitch">
                <div class="power-up-title">üåà GLITCH MODE</div>
                <div class="power-up-description">Ball teleports randomly and changes colors</div>
            </div>
            <div class="power-up-option" data-power="teleport">
                <div class="power-up-title">‚ö° TELEPORT</div>
                <div class="power-up-description">Ball instantly appears in opponent's territory</div>
            </div>
            <div class="power-up-option" data-power="shrink">
                <div class="power-up-title">üî∏ SHRINK BALL</div>
                <div class="power-up-description">Ball becomes much smaller and harder to hit</div>
            </div>
            <div class="power-up-option" data-power="grow">
                <div class="power-up-title">üî∂ GROW BALL</div>
                <div class="power-up-description">Ball becomes larger and easier to hit</div>
            </div>
            <div class="power-up-option" data-power="speed">
                <div class="power-up-title">üöÄ SPEED BOOST</div>
                <div class="power-up-description">Ball moves much faster</div>
            </div>
            <div class="power-up-option" data-power="slowmo">
                <div class="power-up-title">üêå SLOW MOTION</div>
                <div class="power-up-description">Ball moves in slow motion</div>
            </div>
        </div>
        <div class="menu-buttons">
            <button class="menu-button" id="confirmButton" disabled>Confirm Selection</button>
            <button class="menu-button" id="skipButton">Skip Power-up</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const powerUpMenu = document.getElementById('powerUpMenu');
        const menuTitle = document.getElementById('menuTitle');
        const confirmButton = document.getElementById('confirmButton');
        const skipButton = document.getElementById('skipButton');
        
        // Game state
        let gameRunning = false;
        let gameStarted = false;
        let powerUpActive = false;
        let powerUpType = '';
        let selectedPowerUp = '';
        let menuOpen = false;
        let losingPlayer = 0;
        
        // Paddle properties
        const paddleWidth = 10;
        const paddleHeight = 100;
        const paddleSpeed = 5;
        
        // Player 1 paddle (left)
        const player1 = {
            x: 10,
            y: canvas.height / 2 - paddleHeight / 2,
            width: paddleWidth,
            height: paddleHeight,
            score: 0
        };
        
        // Player 2 paddle (right)
        const player2 = {
            x: canvas.width - paddleWidth - 10,
            y: canvas.height / 2 - paddleHeight / 2,
            width: paddleWidth,
            height: paddleHeight,
            score: 0
        };
        
        // Ball properties
        const ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 8,
            speedX: 4,
            speedY: 3,
            maxSpeed: 12,
            hitCount: 0,
            glitchTimer: 0,
            glitchActive: false,
            originalSpeedX: 4,
            originalSpeedY: 3
        };
        
        // Input handling
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            if (menuOpen) return;
            
            keys[e.key.toLowerCase()] = true;
            keys[e.key] = true;
            
            if (!gameStarted) {
                startGame();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
            keys[e.key] = false;
        });
        
        // Power-up menu event listeners
        document.querySelectorAll('.power-up-option').forEach(option => {
            option.addEventListener('click', () => {
                // Remove previous selection
                document.querySelectorAll('.power-up-option').forEach(opt => opt.classList.remove('selected'));
                
                // Select current option
                option.classList.add('selected');
                selectedPowerUp = option.dataset.power;
                confirmButton.disabled = false;
            });
        });
        
        confirmButton.addEventListener('click', () => {
            if (selectedPowerUp) {
                activatePowerUp(selectedPowerUp);
                closePowerUpMenu();
            }
        });
        
        skipButton.addEventListener('click', () => {
            closePowerUpMenu();
        });
        
        function startGame() {
            gameStarted = true;
            gameRunning = true;
            resetBall();
            gameLoop();
        }
        
        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.speedX = (Math.random() > 0.5 ? 1 : -1) * 4;
            ball.speedY = (Math.random() - 0.5) * 6;
            ball.hitCount = 0;
            ball.originalSpeedX = Math.abs(ball.speedX);
            ball.originalSpeedY = Math.abs(ball.speedY);
            
            // Don't reset power-ups here - they persist until opponent scores
            if (!powerUpActive) {
                ball.radius = 8;
                ball.glitchTimer = 0;
                ball.glitchActive = false;
            }
        }
        
        function showPowerUpMenu(player) {
            menuOpen = true;
            gameRunning = false;
            losingPlayer = player;
            menuTitle.textContent = `Player ${player} - Choose Your Power-up!`;
            
            // Reset menu state
            document.querySelectorAll('.power-up-option').forEach(opt => opt.classList.remove('selected'));
            selectedPowerUp = '';
            confirmButton.disabled = true;
            
            powerUpMenu.classList.remove('hidden');
        }
        
        function closePowerUpMenu() {
            menuOpen = false;
            gameRunning = true;
            powerUpMenu.classList.add('hidden');
            resetBall();
        }
        
        function activatePowerUp(powerType) {
            powerUpActive = true;
            powerUpType = powerType;
            
            switch(powerType) {
                case 'glitch':
                    ball.glitchActive = true;
                    ball.glitchTimer = 999999; // Persist until opponent scores
                    break;
                case 'teleport':
                    // Teleport ball to opponent's side
                    if (losingPlayer === 1) {
                        ball.x = canvas.width * 0.75;
                    } else {
                        ball.x = canvas.width * 0.25;
                    }
                    ball.y = Math.random() * (canvas.height - 100) + 50;
                    break;
                case 'shrink':
                    ball.radius = 4;
                    break;
                case 'grow':
                    ball.radius = 16;
                    break;
                case 'speed':
                    ball.speedX = ball.speedX > 0 ? 8 : -8;
                    ball.speedY = ball.speedY > 0 ? 6 : -6;
                    break;
                case 'slowmo':
                    ball.speedX = ball.speedX > 0 ? 2 : -2;
                    ball.speedY = ball.speedY > 0 ? 1.5 : -1.5;
                    break;
            }
        }
        
        function deactivatePowerUp() {
            powerUpActive = false;
            powerUpType = '';
            ball.glitchActive = false;
            ball.glitchTimer = 0;
            ball.radius = 8;
            
            // Reset speed to normal progression
            const currentDirection = ball.speedX > 0 ? 1 : -1;
            ball.speedX = currentDirection * Math.min(ball.originalSpeedX * (1 + ball.hitCount * 0.1), ball.maxSpeed);
        }
        
        function updatePaddles() {
            // Player 1 controls (W/S)
            if (keys['w'] && player1.y > 0) {
                player1.y -= paddleSpeed;
            }
            if (keys['s'] && player1.y < canvas.height - player1.height) {
                player1.y += paddleSpeed;
            }
            
            // Player 2 controls (Arrow keys)
            if (keys['ArrowUp'] && player2.y > 0) {
                player2.y -= paddleSpeed;
            }
            if (keys['ArrowDown'] && player2.y < canvas.height - player2.height) {
                player2.y += paddleSpeed;
            }
        }
        
        function updateBall() {
            // Handle glitch effect
            if (ball.glitchActive && ball.glitchTimer > 0) {
                ball.glitchTimer--;
                // Random teleportation within opponent's area
                if (Math.random() < 0.08) {
                    if (ball.speedX > 0) {
                        ball.x = canvas.width * 0.6 + Math.random() * canvas.width * 0.3;
                    } else {
                        ball.x = canvas.width * 0.1 + Math.random() * canvas.width * 0.3;
                    }
                    ball.y = Math.random() * (canvas.height - 100) + 50;
                }
            }
            
            ball.x += ball.speedX;
            ball.y += ball.speedY;
            
            // Top and bottom wall collision
            if (ball.y - ball.radius <= 0 || ball.y + ball.radius >= canvas.height) {
                ball.speedY = -ball.speedY;
            }
            
            // Paddle collision detection
            // Player 1 paddle
            if (ball.x - ball.radius <= player1.x + player1.width &&
                ball.y >= player1.y &&
                ball.y <= player1.y + player1.height &&
                ball.speedX < 0) {
                ball.speedX = -ball.speedX;
                ball.hitCount++;
                
                // Add some angle based on where the ball hits the paddle
                const hitPos = (ball.y - player1.y) / player1.height;
                ball.speedY = (hitPos - 0.5) * 6;
                
                // Progressive speed increase after 5 hits (if not overridden by power-ups)
                if (powerUpType !== 'speed' && powerUpType !== 'slowmo') {
                    if (ball.hitCount >= 5) {
                        ball.speedX = Math.min(ball.speedX * 1.15, ball.maxSpeed);
                    } else {
                        ball.speedX = Math.min(ball.speedX * 1.05, ball.maxSpeed);
                    }
                }
            }
            
            // Player 2 paddle
            if (ball.x + ball.radius >= player2.x &&
                ball.y >= player2.y &&
                ball.y <= player2.y + player2.height &&
                ball.speedX > 0) {
                ball.speedX = -ball.speedX;
                ball.hitCount++;
                
                // Add some angle based on where the ball hits the paddle
                const hitPos = (ball.y - player2.y) / player2.height;
                ball.speedY = (hitPos - 0.5) * 6;
                
                // Progressive speed increase after 5 hits (if not overridden by power-ups)
                if (powerUpType !== 'speed' && powerUpType !== 'slowmo') {
                    if (ball.hitCount >= 5) {
                        ball.speedX = Math.max(ball.speedX * 1.15, -ball.maxSpeed);
                    } else {
                        ball.speedX = Math.max(ball.speedX * 1.05, -ball.maxSpeed);
                    }
                }
            }
            
            // Scoring
            if (ball.x < 0) {
                player2.score++;
                updateScore();
                
                // Deactivate power-ups when opponent scores
                if (powerUpActive) {
                    deactivatePowerUp();
                }
                
                // Show power-up menu if player 1 is losing
                if (player1.score < player2.score) {
                    showPowerUpMenu(1);
                } else {
                    resetBall();
                }
                checkWinner();
            } else if (ball.x > canvas.width) {
                player1.score++;
                updateScore();
                
                // Deactivate power-ups when opponent scores
                if (powerUpActive) {
                    deactivatePowerUp();
                }
                
                // Show power-up menu if player 2 is losing
                if (player2.score < player1.score) {
                    showPowerUpMenu(2);
                } else {
                    resetBall();
                }
                checkWinner();
            }
        }
        
        function updateScore() {
            document.getElementById('player1Score').textContent = player1.score;
            document.getElementById('player2Score').textContent = player2.score;
        }
        
        function checkWinner() {
            if (player1.score >= 10 || player2.score >= 10) {
                gameRunning = false;
                const winner = player1.score >= 10 ? 'Player 1' : 'Player 2';
                setTimeout(() => {
                    alert(`${winner} wins! Press any key to play again.`);
                    resetGame();
                }, 100);
            }
        }
        
        function resetGame() {
            player1.score = 0;
            player2.score = 0;
            player1.y = canvas.height / 2 - paddleHeight / 2;
            player2.y = canvas.height / 2 - paddleHeight / 2;
            updateScore();
            deactivatePowerUp();
            resetBall();
            gameStarted = false;
            gameRunning = false;
            menuOpen = false;
            powerUpMenu.classList.add('hidden');
        }
        
        function draw() {
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw center line
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw paddles
            ctx.fillStyle = '#fff';
            ctx.fillRect(player1.x, player1.y, player1.width, player1.height);
            ctx.fillRect(player2.x, player2.y, player2.width, player2.height);
            
            // Draw ball (with glitch effect if active)
            ctx.fillStyle = ball.glitchActive ? 
                `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})` : '#fff';
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw power-up indicator
            if (powerUpActive) {
                ctx.font = '16px Courier New';
                ctx.textAlign = 'center';
                ctx.fillStyle = '#ffff00';
                let powerUpText = '';
                switch(powerUpType) {
                    case 'glitch': powerUpText = 'GLITCH MODE ACTIVE!'; break;
                    case 'teleport': powerUpText = 'TELEPORTED!'; break;
                    case 'shrink': powerUpText = 'SMALL BALL!'; break;
                    case 'grow': powerUpText = 'BIG BALL!'; break;
                    case 'speed': powerUpText = 'SPEED BOOST!'; break;
                    case 'slowmo': powerUpText = 'SLOW MOTION!'; break;
                }
                ctx.fillText(powerUpText, canvas.width / 2, 30);
                ctx.fillText('(Until opponent scores)', canvas.width / 2, 50);
            }
            
            // Draw start message
            if (!gameStarted && !menuOpen) {
                ctx.font = '24px Courier New';
                ctx.textAlign = 'center';
                ctx.fillStyle = '#fff';
                ctx.fillText('Press any key to start!', canvas.width / 2, canvas.height / 2 + 50);
            }
            
            // Draw hit counter and speed indicator
            if (gameStarted && gameRunning) {
                ctx.font = '14px Courier New';
                ctx.textAlign = 'left';
                ctx.fillStyle = ball.hitCount >= 5 ? '#ff0000' : '#fff';
                ctx.fillText(`Hits: ${ball.hitCount}`, 10, canvas.height - 20);
                
                if (ball.hitCount >= 5 && powerUpType !== 'speed' && powerUpType !== 'slowmo') {
                    ctx.fillStyle = '#ff0000';
                    ctx.fillText('TURBO MODE!', 10, canvas.height - 5);
                }
            }
            
            // Draw pause message when menu is open
            if (menuOpen) {
                ctx.font = '20px Courier New';
                ctx.textAlign = 'center';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.fillText('Game Paused - Select Power-up', canvas.width / 2, canvas.height / 2);
            }
        }
        
        function gameLoop() {
            if (gameRunning && !menuOpen) {
                updatePaddles();
                updateBall();
            }
            
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Initialize the game
        draw();
    </script>
</body>
</html>
